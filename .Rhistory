} else {
if(is.null(jsonlite::fromJSON(doc)$statusMessage)){
if(is.null(jsonlite::fromJSON(doc)$error)){
attr(respData, 'error') <-
jsonlite::fromJSON(doc)$message
} else {
attr(respData, 'error') <-
jsonlite::fromJSON(doc)$error
}
} else {
attr(respData, 'error') <-
jsonlite::fromJSON(doc)$statusMessage
}
}
}
respData
}
readItems <- function(app, repo_url) {
if (length(app) == 0) {
data.frame()
return()
}
respData <- readRawItems(app, repo_url)
if(nrow(respData) > 0){
if('version' %in% colnames(respData)){
if(respData[1, 'version'] == oydDataVersion){
oydDecrypt(app, repo_url, respData)
} else {
respData
}
} else {
respData
}
} else {
respData
}
}
deleteItem <- function(app, repo_url, id){
headers <- defaultHeaders(app$token)
item_url <- paste0(repo_url, '/', id)
response <- tryCatch(
httr::DELETE(item_url,
httr::add_headers(headers)),
error = function(e) { return(NA) })
if(!is.null(response$status_code)){
response$status_code
} else {
'unknown'
}
}
app <- setupApp('https://lwp.data-vault.eu',
'421d16f2bb906f5a2bea1b5043c1b16c13ba7142b941e5273684f75a2d7ea492',
'789e416cfcbba91223fd5cfb3409fe5c0acc82a785f7bfa927dddc54990ebcc0',
'')
app$token
url <- itemsUrl(app$url, 'eu.ownyourdata.room.office.temperature')
newItem <- list(value = 25)
retVal <- writeItem(app, url, newItem)
newItem <- list(value = 25,
created_at = "2017-11-19T:04:30:40+06:00")
retVal <- writeItem(app, url, newItem)
app_orig <- setupApp('https://demo.datentresor.org',
'eu.ownyourdata.room',
'6XUmKUm4jH4myUm1fMi1',
'')
app_orig$token
retVal <- readItems(app_orig$url, 'eu.ownyourdata.room.temp')
app_orig <- setupApp('https://demo.datentresor.org',
'eu.ownyourdata.room',
'6XUmKUm4jH4myUm1fMi1',
'')
orig_url <- itemsUrl(app_orig$url, 'eu.ownyourdata.room.temp')
retVal <- readItems(app_orig, orig_url)
View(retVal)
retVal[i1, 'value']
retVal[1, 'value']
as.POSIXct('1479591000', '%Y-%m-%dT%H:%M:%SZ', tz = 'UTC')
as.POSIXct(1479591000, '%Y-%m-%dT%H:%M:%SZ', tz = 'UTC')
as.POSIXct(1479591000, origin="1970-01-01")
as.POSIXct(1479591000, origin="1970-01-01", '%Y-%m-%dT%H:%M:%SZ')
as.POSIXct(1479591000, origin="1970-01-01", '%Y-%m-%dT%H:%M:%SZ', tz = 'UTC')
as.POSIXct(1479591000, origin='1970-01-01')
as.POSIXct(1479591000, '%Y-%m-%dT%H:%M:%SZ', origin='1970-01-01')
?as.POSIXct
as.POSIXct(1479591000, tz='UTC', origin='1970-01-01')
as.POSIXct(1479591000, tz='UTC', origin='1970-01-01', format='%Y-%m-%dT%H:%M:%SZ')
as.POSIXct(1479591000, tz='UTC', origin='1970-01-01')
as.POSIXct(1479591000, tz='UTC', origin='1970-01-01', format='%Y-%m-%d')
as.POSIXct(1479591000, tz='UTC', origin='1970-01-01')
format(as.POSIXct(1479591000, tz='UTC', origin='1970-01-01'), '%Y-%m-%dT%H:%M:%SZ')
format(as.POSIXct(retVal[1, 'timestamp']), tz='UTC', origin='1970-01-01'), '%Y-%m-%dT%H:%M:%SZ')
format(as.POSIXct(retVal[1, 'timestamp'], tz='UTC', origin='1970-01-01'), '%Y-%m-%dT%H:%M:%SZ')
format(as.POSIXct(retVal[2, 'timestamp'], tz='UTC', origin='1970-01-01'), '%Y-%m-%dT%H:%M:%SZ')
app <- setupApp('https://lwp.data-vault.eu',
'421d16f2bb906f5a2bea1b5043c1b16c13ba7142b941e5273684f75a2d7ea492',
'789e416cfcbba91223fd5cfb3409fe5c0acc82a785f7bfa927dddc54990ebcc0',
'')
url <- itemsUrl(app$url, 'eu.ownyourdata.room.office.temperature')
for (i in 1:3){
newItem <- list(value = retVal[i, 'value'],
created_at = format(as.POSIXct(retVal[i, 'timestamp'], tz='UTC', origin='1970-01-01'), '%Y-%m-%dT%H:%M:%SZ'))
resp <- writeItem(app, url, newItem)
}
for (i in 1:nrow(retVal)){
newItem <- list(value = retVal[i, 'value'],
created_at = format(as.POSIXct(retVal[i, 'timestamp'], tz='UTC', origin='1970-01-01'), '%Y-%m-%dT%H:%M:%SZ'))
resp <- writeItem(app, url, newItem)
}
library(sodium)
keyStr <- 'secret'
unknown_private_key <- sha256(charToRaw(keyStr))
public_key <- pubkey(unknown_private_key)
public_key <- 'ae2f4b833d7ce8048e433e712d091e29b41393190dae51f84bf25b0f4bbf9dce'
public_key_raw <- as.raw(strtoi(sapply(seq(1, nchar(public_key), by=2),
function(x) substr(public_key, x, x+1)), 16L))
library(sodium)
public_key <- 'ae2f4b833d7ce8048e433e712d091e29b41393190dae51f84bf25b0f4bbf9dce'
public_key_raw <- as.raw(strtoi(sapply(seq(1, nchar(public_key), by=2),
function(x) substr(public_key, x, x+1)), 16L))
authentication_key <- sodium::sha256(charToRaw('auth'))
nonce <- sodium::random(24)
message <- '{"latitude”:40.75,"longitude”:73.98,"elevation”:160.34,"timestamp":"2017-12-28T16:49:22Z","datum":"EPSG:4326”}'
message_raw <- charToRaw(message)
cipher <- sodium::auth_encrypt(message_raw,
authentication_key,
public_key_raw,
nonce)
value <- paste0(as.hexmode(as.integer(cipher)), collapse = '')
nonce <- paste0(as.hexmode(as.integer(nonce)), collapse = '')
record <- jsonlite::toJSON(list(value   = value,
nonce   = nonce,
version = "0.4"),
auto_unbox = TRUE)
record
public_key_raw
?as.raw
?auth_encrypt
?sodium::data_encrypt
?sodium::nonce
?charToRaw
srv_url <- 'http://localhost:3005'
auth_url <- paste0(srv_url, '/oauth/token')
response <- RCurl::postForm(auth_url,
email      = 'christoph.fabianek@gmail.com',
password   = 'asdf123',
grant_type = 'password')
response
keyStr <- 'test'
prvKey<- sha256(charToRaw(keyStr))
pubkey <- pubkey(prvKey)
keyStr <- 'mobile'
prvKey<- sha256(charToRaw(keyStr))
pubkey <- pubkey(prvKey)
keyStr <- 'mobil'
prvKey<- sha256(charToRaw(keyStr))
pubkey <- pubkey(prvKey)
keyStr <- 'mobile'
prvKey<- sha256(charToRaw(keyStr))
pubkey <- pubkey(prvKey)
keyStr <- 'mobile'
prvKey<- sha256(charToRaw(keyStr))
pubkey <- pubkey(prvKey)
paste(as.character(pubkey), collapse='')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
message <- '{"latitude”:40.75846,"longitude”:73.92248,"elevation”:160.34,"timestamp":"2017-12-28T16:49:22Z","datum":"EPSG:4326”}'
source('~/.active-rstudio-document')
record
source('~/oyd/oydapp/R/srvBase.R')
app <- setupApp("https://mobile-api.data-vault.eu", "8ac6377e5697123aa18f8bca860f3bd2d8db6ec54002cc3becbdce9b1ac97943", "95f1ea7336476d2d6c9b352c75d7bad1d2de0d3c456b973d3e9ffae4e00a1694", '')
View(defaultHeaders)
View(oydDecrypt)
View(app)
rep_url <- itemsUrl(app$url, 'eu.ownyourdata.location')
repo_url <- itemsUrl(app$url, 'eu.ownyourdata.location')
rm(rep_url)
items <- readItems(app, repo_url)
source('~/oyd/oydapp/R/general.R')
source('~/oyd/oydapp/R/srvHelper.R')
items <- readItems(app, repo_url)
View(getReadKey)
View(getKey)
load("~/oyd/app-location/tmpApp.RData")
respData <- readRawItems(app, repo_url)
View(respData)
nrow(respData)
'version' %in% colnames(respData)
respData[1, 'version']
respData[1, 'version'] == oydDataVersion
oydDecrypt(app, repo_url, respData)
app
repo_url
respData
'version' %in% colnames(respData)
respData[1, 'version'] == oydDataVersion
x <- respData[1, 'version'] == oydDataVersion
x == TRUE
if(respData[1, 'version'] == oydDataVersion){ cat("yes") } else { cat("no")}
repo_url
data <- respData
privateKey <- getReadKey(app$encryption,
repoFromUrl(repo_url))
errorMsg <- ''
warningMsg <- ''
retVal <- data.frame()
length(privateKey)
anyNA(data$nonce)
authKey <- sodium::pubkey(
sodium::sha256(charToRaw('auth')))
decryptError <- FALSE
data$json <- tryCatch(
apply(data, 1, function(x) {
cipher <- str2raw(as.character(
x['value']))
nonce <- str2raw(as.character(
x['nonce']))
rawToChar(sodium::auth_decrypt(
cipher,
privateKey,
authKey,
nonce))
}),
error = function(e) {
decryptError <<- TRUE
return(NA) })
data$json
decryptError
nchar(errorMsg)
parseError <- FALSE
retVal <- tryCatch(
do.call(rbind.data.frame,
lapply(data$json,
function(x) jsonlite::fromJSON(x))),
error = function(e) {
parseError <<- TRUE
return(data.frame()) })
do.call(rbind.data.frame,
lapply(data$json,
function(x) jsonlite::fromJSON(x)))
data$json
items <- readItems(app, repo_url)
)
items <- readItems(app, repo_url)
View(items)
# erzeuge key
keyStr <- 'secret'
private_key <- sodium::sha256(charToRaw(keyStr))
public_key <- sodium::pubkey(private_key)
auth_private_key <- sha256(charToRaw('auth'))
auth_private_key <- sodium::sha256(charToRaw('auth'))
nonce <- random(24)
nonce <- sodium::random(24)
message <- "{\"address1\":\"M.Scherz-Str 14\",\"city\":\"Bad Vöslau\",\"zipcode\":\"2540\",\"country\":\"Austria\"}"
msg <- charToRaw(message)
cipher <- auth_encrypt(msg, auth_private_key, public_key, nonce)
cipher <- sodium::auth_encrypt(msg, auth_private_key, public_key, nonce)
jsonlite::toJSON(list(
value = paste0(as.hexmode(as.integer(cipher)), collapse = ''),
nonce = paste0(as.hexmode(as.integer(nonce)), collapse = '')), auto_unbox = T)
source('~/oyd/oydapp/R/srvHelper.R')
raw2str(public_key)
raw2str(private_key)
library(oydapp)
??rintrojs
library(oydapp)
library(oydapp)
library(oydapp)
??createDigest
??unite_
??digest
library(oydapp)
data <- null
data <- NULL
nrow(data)
(nrow(data)>0)
if (nrow(data)>0) {
cat("yes")
}
length(data)
library(oydapp)
library(oydapp)
library(oydapp)
# create user ==============
# defaultHeaders <- function(token) {
#         c('Accept'        = '*/*',
#           'Content-Type'  = 'application/json',
#           'Authorization' = paste('Bearer', token))
# }
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
app_key <- 'ea7cd6274e7160a7dd1e4c7476e9ee3d917069abb2d7cedb7877ffdf5273f717'
app_secret <- 'da3273c6467e2d26e32c767f0ed1b042ec1765ffceccc8f7c7e75b366a3ace9e'
response <- RCurl::postForm(auth_url,
client_id     = app_key,
client_secret = app_secret,
grant_type    = 'client_credentials')
response
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
email <- 'christoph.fabianek@gmail.com'
pwd <- 'asdf123'
response <- RCurl::postForm(auth_url,
email      = email,
password   = pwd,
grant_type = 'password')
response
response <- nil
response <- null
response <- NULL
response
response <- RCurl::postForm(auth_url,
email      = email,
password   = pwd,
grant_type = 'password')
response
RCurl::postForm(auth_url, email      = email, password   = pwd, grant_type = 'password')
auth_url
# createUser_url <- paste0(srv_url, '/api/v1/users/create')
createUser_url <- paste0(srv_url, '/api/users/create')
hdr <- c(Authorization = paste('Bearer', token),
`Content-Type`="application/json")
# create user ==============
# defaultHeaders <- function(token) {
#         c('Accept'        = '*/*',
#           'Content-Type'  = 'application/json',
#           'Authorization' = paste('Bearer', token))
# }
srv_url <- 'http://localhost:3001'
app_key <- 'ea7cd6274e7160a7dd1e4c7476e9ee3d917069abb2d7cedb7877ffdf5273f717'
app_secret <- 'da3273c6467e2d26e32c767f0ed1b042ec1765ffceccc8f7c7e75b366a3ace9e'
response <- RCurl::postForm(auth_url,
client_id     = app_key,
client_secret = app_secret,
grant_type    = 'client_credentials')
token <- jsonlite::fromJSON(response[1])$access_token
# createUser_url <- paste0(srv_url, '/api/v1/users/create')
createUser_url <- paste0(srv_url, '/api/users/create')
hdr <- c(Authorization = paste('Bearer', token),
`Content-Type`="application/json")
fields <- jsonlite::toJSON(list(
email = "christoph.fabianek@gmail.com",
language = "de",
frontend_url = "http://localhost:3000"), auto_unbox = TRUE)
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
RCurl::postForm(createUser_url, .opts=list(httpheader = hdr, postfields = fields))
createUser_url
hdr
fields
fields <- jsonlite::toJSON(list(
fields <- jsonlite::toJSON(list(
email = "christoph.fabianek@gmail.com",
language = "de"))
))
fields <- jsonlite::toJSON(list(
email = "christoph.fabianek@gmail.com",
language = "de"))
RCurl::postForm(createUser_url, .opts=list(httpheader = hdr, postfields = fields))
fields <- jsonlite::toJSON(list(
email = "christoph.fabianek@gmail.com",
language = "en"))
RCurl::postForm(createUser_url, .opts=list(httpheader = hdr, postfields = fields))
fields <- jsonlite::toJSON(list(
email = "christoph.fabianek@gmail.com",
language = "en"))
fields
fields <- jsonlite::toJSON(list(
email = "christoph.fabianek@gmail.com",
language = "de"), auto_unbox = TRUE)
fields
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
fields <- jsonlite::toJSON(list(
email = "christoph@fabianek.at",
language = "de"), auto_unbox = TRUE)
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
fields <- jsonlite::toJSON(list(
email = "christoph@fabianek.at",
language = "de",
frontend_url = "http://localhost:3000"), auto_unbox = TRUE)
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
fields <- jsonlite::toJSON(list(
email = "christoph@fabianek.at",
language = "de",
frontend_url = "http://localhost:3001"), auto_unbox = TRUE)
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
# create user ==============
# defaultHeaders <- function(token) {
#         c('Accept'        = '*/*',
#           'Content-Type'  = 'application/json',
#           'Authorization' = paste('Bearer', token))
# }
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
app_key <- 'ea7cd6274e7160a7dd1e4c7476e9ee3d917069abb2d7cedb7877ffdf5273f717'
app_secret <- 'da3273c6467e2d26e32c767f0ed1b042ec1765ffceccc8f7c7e75b366a3ace9e'
response <- RCurl::postForm(auth_url,
client_id     = app_key,
client_secret = app_secret,
grant_type    = 'client_credentials')
token <- jsonlite::fromJSON(response[1])$access_token
token
# createUser_url <- paste0(srv_url, '/api/v1/users/create')
createUser_url <- paste0(srv_url, '/api/users/create')
hdr <- c(Authorization = paste('Bearer', token),
`Content-Type`="application/json")
fields <- jsonlite::toJSON(list(
email = "christoph@fabianek.at",
language = "de",
frontend_url = "http://localhost:3001"), auto_unbox = TRUE)
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
email <- 'christoph.fabianek@gmail.com'
pwd <- 'asdf123'
response <- RCurl::postForm(auth_url,
email      = email,
password   = pwd,
grant_type = 'password')
response <- RCurl::postForm(auth_url,
email      = email,
password   = pwd,
grant_type = 'client_credential')
# create user ==============
# defaultHeaders <- function(token) {
#         c('Accept'        = '*/*',
#           'Content-Type'  = 'application/json',
#           'Authorization' = paste('Bearer', token))
# }
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
app_key <- 'ea7cd6274e7160a7dd1e4c7476e9ee3d917069abb2d7cedb7877ffdf5273f717'
app_secret <- 'da3273c6467e2d26e32c767f0ed1b042ec1765ffceccc8f7c7e75b366a3ace9e'
response <- RCurl::postForm(auth_url,
client_id     = app_key,
client_secret = app_secret,
grant_type    = 'client_credentials')
token <- jsonlite::fromJSON(response[1])$access_token
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
email <- 'christoph.fabianek@gmail.com'
pwd <- 'qwertz'
response <- RCurl::postForm(auth_url,
email      = email,
password   = pwd,
grant_type = 'password')
# create user ==============
# defaultHeaders <- function(token) {
#         c('Accept'        = '*/*',
#           'Content-Type'  = 'application/json',
#           'Authorization' = paste('Bearer', token))
# }
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
app_key <- 'ea7cd6274e7160a7dd1e4c7476e9ee3d917069abb2d7cedb7877ffdf5273f717'
app_secret <- 'da3273c6467e2d26e32c767f0ed1b042ec1765ffceccc8f7c7e75b366a3ace9e'
response <- RCurl::postForm(auth_url,
client_id     = app_key,
client_secret = app_secret,
grant_type    = 'client_credentials')
token <- jsonlite::fromJSON(response[1])$access_token
# createUser_url <- paste0(srv_url, '/api/v1/users/create')
createUser_url <- paste0(srv_url, '/api/users/create')
hdr <- c(Authorization = paste('Bearer', token),
`Content-Type`="application/json")
fields <- jsonlite::toJSON(list(
email = "christoph@fabianek.at",
language = "de",
frontend_url = "http://localhost:3001"), auto_unbox = TRUE)
response <- RCurl::postForm(createUser_url,
.opts=list(httpheader = hdr,
postfields = fields))
srv_url <- 'http://localhost:3001'
auth_url <- paste0(srv_url, '/oauth/token')
email <- 'christoph@fabianek.at'
pwd <- 'asdf123'
response <- RCurl::postForm(auth_url,
email      = email,
password   = pwd,
grant_type = 'password')
library(oydapp)
load("~/oyd/views/app-location/tmpInv.RData")
if (length(app) == 0) {
data.frame()
return()
}
respData <- readRawItems(app, repo_url)
page_size = 2000
headers <- defaultHeaders(app$token)
url_data <- paste0(repo_url, '?size=', page_size)
header <- RCurl::basicHeaderGatherer()
doc <- tryCatch(
RCurl::getURI(url_data,
.opts=list(httpheader = headers),
headerfunction = header$update),
error = function(e) { return(NA) })
